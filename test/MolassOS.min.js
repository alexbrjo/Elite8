function Intel8008Cpu(a){var b=Intel8008Registers(),c=a||new Memory(256),d=operation;this.cycle=function(){var a=c.read(b.PC),e=c.peek(1),f=c.peek(2);d[a](b,e,f)}}function Memory(a,b){if(a<1)throw new Error("Memory must have at least 1 byte.");if(void 0!==b&&"RAM"!==b&&"ROM"!==b)throw new Error("Unsupported memory type: "+b);var a=a||512,c=-1,d="ROM"!==b,e=new Uint8Array(a);this.read=function(a){if(a<0||a>=e.length)throw new Error("Illegal memory access: "+a);return c=a,e[c]},this.peek=function(a){var b=c+a;if(b<0||b>=e.length)throw new Error("Illegal memory access: "+b);return e[b]},this.write=function(a,b){if("number"==typeof a&&void 0===b)c++,this.write(c,a);else{if(!d)throw new Error("Cannot write to ROM");if(a<0||a>=e.length)throw new Error("Illegal memory access: "+a);a>=0&&b<256&&(c=a,e[c]=b)}},this.hasNext=function(){return c>=0&&c<e.length},this.pos=function(){return c},this.clear=function(){for(c=0;c<e.length;c++)e[c]=0;c=-1},this.size=function(){return a},this.clear()}function Intel8008Registers(){return{a:0,get A(){return this.a},set A(a){if(!(a>=0&&a<=255&&a%1==0))throw new Error("Register A cannot store value: "+a);this.a=a},b:0,c:0,d:0,e:0,get B(){return this.b},set B(a){if(!(a>=0&&a<=255&&a%1==0))throw new Error("Register B cannot store value: "+a);this.b=a},get C(){return this.c},set C(a){if(!(a>=0&&a<=255&&a%1==0))throw new Error("Register C cannot store value: "+a);this.c=a},get D(){return this.d},set D(a){if(!(a>=0&&a<=255&&a%1==0))throw new Error("Register D cannot store value: "+a);this.d=a},get E(){return this.e},set E(a){if(!(a>=0&&a<=255&&a%1==0))throw new Error("Register E cannot store value: "+a);this.e=a},h:0,l:0,get H(){return this.h},set H(a){if(!(a>=0&&a<=255&&a%1==0))throw new Error("Register H cannot store value: "+a);this.h=a},get L(){return this.l},set L(a){if(!(a>=0&&a<=255&&a%1==0))throw new Error("Register L cannot store value: "+a);this.l=a},get M(){return 256*this.H+this.L},set M(a){this.H=Math.floor(a/256),this.L=a-256*this.H},sign:0,get SIGN(){return this.sign},set SIGN(a){if(0!==a&&1!==a)throw new Error("Sign Flag cannot store value: "+a);this.sign=a},zero:0,get ZERO(){return this.zero},set ZERO(a){if(0!==a&&1!==a)throw new Error("Zero Flag cannot store value: "+a);this.zero=a},parity:0,get PARITY(){return this.parity},set PARITY(a){if(0!==a&&1!==a)throw new Error("Parity Flag cannot store value: "+a);this.parity=a},carry:0,get CARRY(){return this.carry},set CARRY(a){if(0!==a&&1!==a)throw new Error("Carry Flag cannot store value: "+a);this.carry=a},pc:0,get PC(){return this.pc},set PC(a){if(a<0&&a>16384)throw new Error("PC cannot store value: "+a);this.pc=a},stack:[0,0,0,0,0,0,0],get POP(){return this.pc},set PUSH(a){if(a<0&&a>16384)throw new Error("PC cannot store value: "+a);this.pc=a}}}function SugarAssembler(){var a=function(a){var b=Math.floor(a/256);return{0:a-256*b,1:b,get low(){return this[0]},get high(){return this[1]}}};this.assemble=function(b,c){for(var d=b.split("\n"),e={},f=new Memory(c||512),g="init",h=0;h<d.length;h++){var i=d[h].split(" ").filter(function(a){return 0!==a.length});switch(i[0]){case"HLT":f.write(operation.HLT),g="new_line";break;case"JMP":f.write(operation.JMP),g="wait_address";break;case"JNZ":f.write(operation.JNZ),g="wait_address";break;case"JNC":f.write(operation.JNC),g="wait_address";break;case"JP":f.write(operation.JP),g="wait_address";break;case"JPO":f.write(operation.JPO),g="wait_address";break;case"JZ":f.write(operation.JZ),g="wait_address";break;case"JP":f.write(operation.JP),g="wait_address";break;case"JM":f.write(operation.JM),g="wait_address";break;case"JPE":f.write(operation.JPE),g="wait_address";break;case"db":case"DB":for(var j=i[1],h=0;h<j.length;h++)f.write(j.charAt(h));g="new_line";break;case"CONST":e[i[1]]=i[2],g="wait_immed";break;default:e[i[0]]=f.pos()+1,g="new_line"}if("wait_immed"===g)f.write(0);else if("wait_address"===g){var k=a(e[i[1]]);f.write(k.low),f.write(k.high),g="new_line"}if("new_line"!==g)throw new Error("Bad Syntax line: "+h)}return{data:f,size:f.size()}}}var operation={HLT:255,JMP:68,JNC:64,JNZ:72,JP:80,JPO:88,JC:96,JZ:104,JM:112,JPE:120,CALL:70,CNC:66,CNZ:74,CP:82,CPO:90,CC:98,CZ:106,CM:114,CPE:122,RET:68,RNC:64,RNZ:70,RP:80,RPO:88,RC:96,RZ:104,RM:112,RPE:120,RST_A:5,RST_B:21,RST_C:37,RST_D:53,RST_E:13,RST_H:29,RST_L:45,RST_M:61,RLC:2,RRC:10,RAL:18,RAR:26,ADD_A:128,ADD_B:129,ADD_C:130,ADD_D:131,ADD_E:132,ADD_H:133,ADD_L:134,ADD_M:135,ADC_A:128,ADC_B:129,ADC_C:130,ADC_D:131,ADC_E:132,ADC_H:133,ADC_L:134,ADC_M:135};operation[4]=function(a,b){var c=a.A+b;c>255?(c%=256,a.CARRY=1):a.CARRY=0,a.SIGN=0,a.ZERO=0===c?1:0,a.PARITY=c%2==0?1:0,a.A=c,a.PC+=2},operation[128]=function(a){var b=a.A+a.A;b>255?(b%=256,a.CARRY=1):a.CARRY=0,a.SIGN=0,a.ZERO=0===b?1:0,a.PARITY=b%2==0?1:0,a.A=b,a.PC+=1},operation[129]=function(a){var b=a.A+a.B;b>255?(b%=256,a.CARRY=1):a.CARRY=0,a.SIGN=0,a.ZERO=0===b?1:0,a.PARITY=b%2==0?1:0,a.A=b,a.PC+=1},operation[130]=function(a){var b=a.A+a.C;b>255?(b%=256,a.CARRY=1):a.CARRY=0,a.SIGN=0,a.ZERO=0===b?1:0,a.PARITY=b%2==0?1:0,a.A=b,a.PC+=1},operation[131]=function(a){var b=a.A+a.D;b>255?(b%=256,a.CARRY=1):a.CARRY=0,a.SIGN=0,a.ZERO=0===b?1:0,a.PARITY=b%2==0?1:0,a.A=b,a.PC+=1},operation[132]=function(a){var b=a.A+a.E;b>255?(b%=256,a.CARRY=1):a.CARRY=0,a.SIGN=0,a.ZERO=0===b?1:0,a.PARITY=b%2==0?1:0,a.A=b,a.PC+=1},operation[133]=function(a){var b=a.A+a.H;b>255?(b%=256,a.CARRY=1):a.CARRY=0,a.SIGN=0,a.ZERO=0===b?1:0,a.PARITY=b%2==0?1:0,a.A=b,a.PC+=1},operation[134]=function(a){var b=a.A+a.L;b>255?(b%=256,a.CARRY=1):a.CARRY=0,a.SIGN=0,a.ZERO=0===b?1:0,a.PARITY=b%2==0?1:0,a.A=b,a.PC+=1},operation[136]=function(a){var b=a.A+a.M;b>255?(b%=256,a.CARRY=1):a.CARRY=0,a.SIGN=0,a.ZERO=0===b,a.PARITY=b%2==0,a.A=b,a.PC+=1},operation[136]=operation[128],operation[137]=operation[129],operation[138]=operation[130],operation[139]=operation[131],operation[140]=operation[132],operation[141]=operation[133],operation[142]=operation[134],operation[143]=operation[135],operation[68]=function(a,b,c){a.PC=255*b+c},operation[84]=operation[68],operation[100]=operation[68],operation[116]=operation[68],operation[76]=operation[68],operation[92]=operation[68],operation[108]=operation[68],operation[124]=operation[68],operation[64]=function(a,b,c){a.PC=255*b+c},operation[70]=function(a,b,c){a.CARRY>0?a.PC=255*b+c:a.PC+=3},operation[80]=function(a,b,c){0===a.SIGN?a.PC=255*b+c:a.PC+=3},operation[88]=function(a,b,c){a.PARITY%2==1?a.PC=255*b+c:a.PC+=3},operation[96]=function(a,b,c){1===a.CARRY?a.PC=255*b+c:a.PC+=3},operation[104]=function(a,b,c){0===a.RESULT?a.PC=255*b+c:a.PC+=3},operation[112]=function(a,b,c){0===a.SIGN?a.PC=255*b+c:a.PC+=3},operation[120]=function(a,b,c){a.PARITY%2==0?a.PC=255*b+c:a.PC+=3},operation[70]=function(a,b,c){a.PUSH(),a.PC=255*b+c},operation[86]=operation[70],operation[102]=operation[70],operation[118]=operation[70],operation[78]=operation[70],operation[94]=operation[70],operation[110]=operation[70],operation[126]=operation[70],operation[64]=function(a,b,c){a.CARRY>0?(a.PUSH(),a.PC=255*b+c):a.PC+=3},operation[68]=function(a,b,c){a.CARRY>0?(a.PUSH(),a.PC=255*b+c):a.PC+=3},operation[72]=function(a,b,c){0===a.SIGN?(a.PUSH(),a.PC=255*b+c):a.PC+=3},operation[88]=function(a,b,c){a.PARITY%2==1?(a.PUSH(),a.PC=255*b+c):a.PC+=3},operation[96]=function(a,b,c){1===a.CARRY?(a.PUSH(),a.PC=255*b+c):a.PC+=3},operation[104]=function(a,b,c){0===a.RESULT?(a.PUSH(),a.PC=255*b+c):a.PC+=3},operation[112]=function(a,b,c){0===a.SIGN?(a.PUSH(),a.PC=255*b+c):a.PC+=3},operation[120]=function(a,b,c){a.PARITY%2==0?(a.PUSH(),a.PC=255*b+c):a.PC+=3},operation[7]=function(a,b,c){a.POP(),a.PC=255*b+c},operation[23]=operation[70],operation[39]=operation[70],operation[55]=operation[70],operation[31]=operation[70],operation[47]=operation[70],operation[63]=operation[70],operation[79]=operation[70],operation[3]=function(a,b,c){a.POP(),a.PC=255*b+c},operation[14]=function(a,b,c){a.CARRY>0?(a.POP(),a.PC=255*b+c):a.PC+=3},operation[19]=function(a,b,c){0===a.SIGN?(a.POP(),a.PC=255*b+c):a.PC+=3},operation[30]=function(a,b,c){a.PARITY%2==1?(a.POP(),a.PC=255*b+c):a.PC+=3},operation[35]=function(a,b,c){1===a.CARRY?(a.POP(),a.PC=255*b+c):a.PC+=3},operation[46]=function(a,b,c){0===a.RESULT?(a.POP(),a.PC=255*b+c):a.PC+=3},operation[51]=function(a,b,c){0===a.SIGN?(a.POP(),a.PC=255*b+c):a.PC+=3},operation[62]=function(a,b,c){a.PARITY%2==0?(a.POP(),a.PC=255*b+c):a.PC+=3},operation[5]=operation[3],operation[21]=operation[19],operation[37]=operation[35],operation[53]=operation[51],operation[13]=operation[14],operation[29]=operation[30],operation[45]=operation[46],operation[61]=operation[62],operation[255]=function(){},operation[0]=operation[255],operation[1]=operation[255],operation[255]=function(){},operation[255]=function(){},operation[2]=function(){},operation[10]=function(){},operation[18]=function(){},operation[26]=function(){};